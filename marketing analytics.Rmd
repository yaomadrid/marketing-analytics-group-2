url: https://github.com/yaomadrid/marketing-analytics-group-2.git
title: "Marketing Analytics"
output: word_document

1. What is the data problem? What is the final managerial objective?
Our dataset covers all mortgage information in 2015 for the state of New York, provided by financial institutions. These information were required by Home Mortgage Disclosure Act (HMDA), which unveils all information of mortgage decisions and helps public to make loan decisions. Our final managerial objective is to find out the factors that influence the approval of mortgage and predict mortgage decision based on our model. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

2.Describe the measurement types of each variable
There are 78 variables in this original dataset, though there are some redundant variables which deliver the same information. We can classify these variables into applicants, loan, lender, property type, location. 

Variable name 	Measurement type     	Variable name 	 Measurement type
action_taken	Nominal            	    denial_reason_1	 Nominal 
action_taken_name	Nominal       	    denial_reason_2  Nominal 
agency_code	Nominal 	                denial_reason_3	  Nominal 
agency_abbr	Nominal 	                denial_reason_name_1	Nominal 
agency_name	Nominal 	                denial_reason_name_2	Nominal 
applicant_ethnicity	Nominal 	        denial_reason_name_3	Nominal 
applicant_ethnicity_name	Nominal 	  edit_status	          Nominal 
applicant_income_000s	Ratio	          edit_status_name	Nominal 
applicant_race_1	Nominal 	          hoepa_status	Nominal 
applicant_race_2	Nominal 	          hoepa_status_name	Nominal 
applicant_race_3	Nominal 	          lien_status	Nominal 
applicant_race_4	Nominal 	          lien_status_name	Nominal 
applicant_race_5	Nominal 	          loan_purpose	Nominal 
applicant_race_name_1	Nominal 	      loan_purpose_name	Nominal 
applicant_race_name_2	Nominal       	loan_type	Nominal 
applicant_race_name_3	Nominal 	      loan_type_name	Nominal 
applicant_race_name_4	Nominal 	      msamd	Nominal 
applicant_race_name_5	Nominal 	      msamd_name	Nominal 
applicant_sex	Nominal 	              owner_occupancy	Nominal 
applicant_sex_name	Nominal 	        owner_occupancy_name	Nominal 
application_date_indicator	Ordinal 	preapproval	Nominal 
as_of_year	Ordinal	                  preapproval_name	Nominal 
census_tract_number	Nominal 	        property_type	Nominal 
co_applicant_ethnicity	Nominal     	property_type_name	Nominal 
co_applicant_ethnicity_name	Nominal 	purchaser_type	Nominal 
co_applicant_race_1	Nominal 	        purchaser_type_name	Nominal 
co_applicant_race_2	Nominal         	respondent_id	Nominal 
co_applicant_race_3	Nominal 	        sequence_number	Ordinal
co_applicant_race_4	Nominal 	        state_code	Nominal 
co_applicant_race_5	Nominal 	        state_abbr	Nominal 
co_applicant_race_name_1	Nominal 	state_name	Nominal 
co_applicant_race_name_2	Nominal 	hud_median_family_income	Ratio
co_applicant_race_name_3	Nominal 	loan_amount_000s	Ratio
co_applicant_race_name_4	Nominal 	number_of_1_to_4_family_units	Ratio
co_applicant_race_name_5	Nominal 	number_of_owner_occupied_units	Ratio
co_applicant_sex	Nominal 	        minority_population	Ratio
co_applicant_sex_name	Nominal      	population	Ratio
county_code	Nominal 	             rate_spread	Ratio
county_name	Nominal               	tract_to_msamd_income	Ratio









```{r}

```

3. Create a table summarizing the range or variation in each variable. Add statistics (mean,
median, standard deviation, etc.) as you deem necessary.

                                       
```{r}


```


4. How do you handle missing data in this dataset?
```{r}
#Identify the number of missing value
sum(is.na(ny_hmda$applicant_income_000s))
sum(is.na(ny_hmda$applicant_race_2))
sum(is.na(ny_hmda$applicant_race_3))
sum(is.na(ny_hmda$applicant_race_4))
sum(is.na(ny_hmda$applicant_race_5))
sum(is.na(ny_hmda$census_tract_number))
sum(is.na(ny_hmda$co_applicant_race_2))
sum(is.na(ny_hmda$co_applicant_race_3))
sum(is.na(ny_hmda$co_applicant_race_4))
sum(is.na(ny_hmda$co_applicant_race_5))
sum(is.na(ny_hmda$county_code))
sum(is.na(ny_hmda$denial_reason_1))
sum(is.na(ny_hmda$denial_reason_2))
sum(is.na(ny_hmda$denial_reason_3))
sum(is.na(ny_hmda$edit_status))
sum(is.na(ny_hmda$msamd))
sum(is.na(ny_hmda$hud_median_family_income))
sum(is.na(ny_hmda$number_of_1_to_4_family_units))
sum(is.na(ny_hmda$number_of_owner_occupied_units))
sum(is.na(ny_hmda$minority_population))
sum(is.na(ny_hmda$population))
sum(is.na(ny_hmda$rate_spread))
sum(is.na(ny_hmda$tract_to_msamd_income))


# deal with the missing of income _000$ #
library("dplyr")
ny_hmda <- ny_hmda %>%
filter(!is.na(applicant_income_000s)) 
ny_hmda$Income.Level = "0"
ny_hmda[ny_hmda$applicant_income_000s <= 60,]$Income.Level = "Level1"
ny_hmda[ny_hmda$applicant_income_000s > 60 & ny_hmda$applicant_income_000s <=90,]$Income.Level = "Level2"
ny_hmda[ny_hmda$applicant_income_000s > 90 & ny_hmda$applicant_income_000s <=150,]$Income.Level = "Level3"
ny_hmda[ny_hmda$applicant_income_000s > 150,]$Income.Level = "Level4"
table(ny_hmda$action_taken_name,ny_hmda$Income.Level)
nyTable<-table(ny_hmda$action_taken_name,ny_hmda$Income.Level)
chisq.test(nyTable)


Mode = function(x){
  ux = sort(unique(x))
  tabx = table(x)
  maxf = ux[which(tabx ==
                    max(tabx))]
  return(maxf)
}
Mode(ny_hmda$applicant_income_000s)
ny_hmda$applicant_income_000s[which(is.na(ny_hmda$applicant_income_000s))] <- 60
summary(ny_hmda$applicant_income_000s)

# deal with the missing of applicant_race_2,3,4,5, deleting the whole column#
DealMissing<-ny_hmda 
DealMissing[,c("applicant_race_2","applicant_race_3","applicant_race_4","applicant_race_5")]<-NULL
DealMissing[,c("applicant_race_name_2","applicant_race_name_3","applicant_race_name_4","applicant_race_name_5")]<-NULL

# deal with the missing of co_applicant_race_2,3,4,5, deleting the whole column#
DealMissing[,c("co_applicant_race_2","co_applicant_race_3","co_applicant_race_4","co_applicant_race_5")]<-NULL
DealMissing[,c("co_applicant_race_name_2","co_applicant_race_name_3","co_applicant_race_name_4","co_applicant_race_name_5")]<-NULL

#deal with the missing of county_code
unique(DealMissing$county_code)
unique(DealMissing$county_name)
CountyTable<-table(DealMissing$action_taken_name,DealMissing$county_name)
chisq.test(CountyTable)
Mode(DealMissing$county_code)
DealMissing$county_code[which(is.na(DealMissing$county_code))] <- 103
DealMissing$county_name[which(is.na(DealMissing$county_name))] <- "Suffolk County"
#write.csv(DealMissing, "DealMissing.csv")

#deal with the missing of census_tract_number
chisq.test(table(DealMissing$action_taken_name,ny_hmda$census_tract_number))
DealMissing$census_tract_number[which(is.na(DealMissing$census_tract_number))]<-Mode(DealMissing$census_tract_number)
#deal with the missing of edit_status
chisq.test(table(DealMissing$action_taken_name,ny_hmda$edit_status))
DealMissing$edit_status[is.na(DealMissing$edit_status)]="0"
DealMissing$is_missing_editstatus<-"0"
DealMissing$is_missing_editstatus[DealMissing$edit_status==0]<-1

#deal with the missing of msamd
chisq.test(table(DealMissing$action_taken_name,ny_hmda$msamd))
DealMissing$msamd[is.na(DealMissing$msamd)]="0"
DealMissing$is_missing_msamd<-"0"
DealMissing$is_missing_msamd[DealMissing$msamd==0]<-1
#deal with the missing of hud_median_family_income
chisq.test(table(DealMissing$action_taken_name,ny_hmda$census_tract_number))
DealMissing$census_tract_number[which(is.na(DealMissing$census_tract_number))]<-Mode(DealMissing$census_tract_number)
#deal with the missing of number_of_1_to_4_family_units
chisq.test(table(DealMissing$action_taken_name,ny_hmda$number_of_1_to_4_family_units))
DealMissing$number_of_1_to_4_family_units[which(is.na(DealMissing$number_of_1_to_4_family_units))]<-Mode(DealMissing$number_of_1_to_4_family_units)
#deal with the missing of number_of_owner_occupied_units
chisq.test(table(DealMissing$action_taken_name,ny_hmda$number_of_owner_occupied_units))
DealMissing$number_of_owner_occupied_units[which(is.na(DealMissing$number_of_owner_occupied_units))]<-Mode(DealMissing$number_of_owner_occupied_units)
#deal with the missing of minority_population
chisq.test(table(DealMissing$action_taken_name,ny_hmda$minority_population))
DealMissing$minority_population[which(is.na(DealMissing$minority_population))]<-Mode(DealMissing$minority_population)
#deal with the missing of population
chisq.test(table(DealMissing$action_taken_name,ny_hmda$population))
DealMissing$population[which(is.na(DealMissing$population))]<-Mode(DealMissing$population)
#deal with the missing of rate_spread
DealMissing[,"rate_spread"]<-NULL
#deal with the missing of tract_to_msamd_income
chisq.test(table(DealMissing$action_taken_name,ny_hmda$tract_to_msamd_income))
DealMissing$population[which(is.na(DealMissing$tract_to_msamd_income))]<-Mode(DealMissing$tract_to_msamd_income)


```


5. Provide histograms/density plots for key variables, such as action taken on loan, gender,
ethnicity, etc.

Action in Loans

```{r}
library(dplyr)
ny_hmda_possessed = ny_hmda %>%
group_by(action_taken_name) %>%
summarize(TotalActionTaken = n()) %>%
mutate(PercentageActionTaken = TotalActionTaken/sum(TotalActionTaken) * 100)
library(ggplot2)
ggplot(ny_hmda_possessed, aes(x = action_taken_name,y = PercentageActionTaken))+ geom_bar(stat='identity',colour="white")+labs( title = 'Actions in Loans')+theme(axis.text.x = element_text(angle = 30, hjust = 1))

```



Hustogram of Income
```{r}
library(dplyr)
ny_hmdaIncome <-ny_hmda %>%
  filter(!is.na(hud_median_family_income)) 
plot(density(ny_hmdaIncome$hud_median_family_income), main = "Histogram of income", 
    xlab = "Income", ylab = "Count (#)")
```

Minority_population distribution
```{r}
library(dplyr)
ny_hm_minority_population <-ny_hmda %>%
  filter(!is.na(minority_population)) 
plot(density(ny_hm_minority_population$minority_population), main = "Minority_population", 
     xlab = "Minority", ylab = "Count (#)")

```

```{r}
ny_hmdaSex= ny_hmda %>%
  filter(applicant_sex < 3) %>%
  group_by(applicant_sex_name) %>%
  summarize(TotalActionTaken = n()) %>%
  mutate(PercentageActionTaken = TotalActionTaken/sum(TotalActionTaken) * 100)
library(ggplot2)
ggplot(ny_hmdaSex, aes(x = applicant_sex_name ,y = PercentageActionTaken))+ geom_bar(stat='identity',colour="red")+labs( title = 'Actions in Loans')



```

Action in Loans by Race
```{r}
ny_hmdaRace= ny_hmda %>%
  filter(applicant_race_1 < 7 )%>%
  group_by(applicant_race_name_1) %>%
  summarize(TotalActionTaken = n()) %>%
  mutate(PercentageActionTaken = TotalActionTaken/sum(TotalActionTaken) * 100)
ny_hmdaRace 
library(ggplot2)
ggplot(ny_hmdaRace, aes(x = applicant_race_name_1,(angle=30) ,y = PercentageActionTaken))+ geom_bar(stat='identity',colour="red")+labs( title = 'Actions in Loans by race')+theme(axis.text.x = element_text(angle = 30, hjust = 1))

```

6. Create bivariate frequency distributions (tables or plots) for key variables. 

Lean_status distribution by actions

```{r}
ny_hmdaLean_status=ny_hmda %>%
group_by(lien_status_name, action_taken_name) %>%
summarize(TotalActionTaken = n()) 
ny_hmdaLean_status
ggplot(ny_hmdaLean_status, aes(x = action_taken_name,y = TotalActionTaken))+ geom_bar(stat='identity',colour="red")+labs( title = 'lean_status distribution by actions')+facet_wrap(~ lien_status_name, scales ="free_y")+theme(axis.text.x = element_text(angle = 30, hjust = 1))
              
```

Loans Purpose Types Distribution with Race

```{r}
ny_hmdaRace_status=ny_hmda %>%
  filter(applicant_race_1 < 7 )%>%
  group_by(applicant_race_name_1, action_taken_name) %>%
  summarize(TotalActionTaken = n()) 
ny_hmdaRace_status
ggplot(ny_hmdaRace_status, aes(x = action_taken_name,y = TotalActionTaken))+ geom_bar(stat='identity',colour="red")+labs( title = ' race destribution by loan actions')+ facet_wrap(~ applicant_race_name_1 , scales ="free_y")+ theme(axis.text.x = element_text(angle = 30, hjust = 1))



```

Loans Purpose Types Distribution with Action Types

```{r }
  ny_hmda %>%
  filter(!is.na(loan_purpose_name)) %>%
  group_by(loan_purpose_name,action_taken_name) %>%
  summarise(CountLoanPurpose = n() ) %>%
  ggplot(aes(x = action_taken_name,y = CountLoanPurpose,fill =(loan_purpose_name))) +
  geom_bar(stat='identity',colour="white") +
  labs(x = 'Loan Purpose', y = 'Count', title = 'Loans Purpose Types Distribution with Action Types') +
  theme_bw()+theme(axis.text.x = element_text(angle = 30, hjust = 1))
```

Relationship between Applicant Income level and Action of Loans

```{r }
ny_hmda_income =  ny_hmda %>%
filter(!is.na(applicant_income_000s)) 
ny_hmda_income$Income.Level = "0"
ny_hmda_income[ny_hmda_income$applicant_income_000s <= 60,]$Income.Level = "Level1"
ny_hmda_income[ny_hmda_income$applicant_income_000s > 60 & ny_hmda_income$applicant_income_000s <=90,]$Income.Level = "Level2"
ny_hmda_income[ny_hmda_income$applicant_income_000s > 90 & ny_hmda_income$applicant_income_000s <=150,]$Income.Level = "Level3"
ny_hmda_income[ny_hmda_income$applicant_income_000s > 150,]$Income.Level = "Level4"
table(ny_hmda_income$action_taken_name,ny_hmda_income$Income.Level)
```
```{r}
summary(car)
1111
```
7. Discuss what the data patterns indicate, and what this could mean for the probability of getting a loan approved.

